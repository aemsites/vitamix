<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <script src="https://da.live/nx/utils/sdk.js" type="module"></script>
    <script src="/tools/recipes/recipes.js" type="module"></script>
    <meta name="Description" content="Vitamix Recipes API Tool" />
    <meta name="robots" content="noindex" />
    <title>Vitamix Recipes Tool</title>
    <link rel="stylesheet" href="./recipes/recipes.css" />
  </head>

  <body>
    <div class="container">
      <h1>Vitamix Recipes Tool</h1>
      <p class="subtitle">Fetch updated recipes from Vitamix CalcMenu API</p>

      <div class="credentials-notice" id="credentialsNotice">
        <strong>Credentials required:</strong> Add <code>?user=YOUR_USER&pw=YOUR_PASSWORD</code> to the URL
      </div>

      <div class="form-section">
        <form id="recipesForm" method="GET">
          <div class="form-group">
            <label for="userId">User ID</label>
            <input type="text" id="userId" name="user" required />
            <div class="help-text">From query parameter: ?user=...</div>
          </div>

          <div class="form-group">
            <label for="password">Password</label>
            <input type="password" id="password" name="pw" required />
            <div class="help-text">From query parameter: ?pw=...</div>
          </div>

          <div class="form-group">
            <label for="dateUpdated">Date Updated</label>
            <input type="date" id="dateUpdated" name="date" />
            <div class="help-text">Leave empty to get all recipes, or specify a date to get recipes updated since that date</div>
          </div>

          <button type="submit" id="submitBtn">Fetch Recipes</button>
        </form>
      </div>

      <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Fetching recipes from API...</p>
      </div>

      <div class="error" id="error"></div>

      <div class="results" id="results">
        <h2>Results</h2>
        <div class="recipe-count" id="recipeCount"></div>
        <div class="filter-container">
          <input type="text" id="recipeFilter" class="recipe-filter" placeholder="Filter recipes..." autocomplete="off" />
          <span id="filterCount" class="filter-count"></span>
        </div>
        <div class="bulk-actions">
          <label class="select-all-container">
            <input type="checkbox" id="selectAll" />
            <span>Select All</span>
          </label>
          <button id="selectUnimportedBtn" class="btn-select-unimported">Select Unimported</button>
          <button id="bulkSelectBtn" class="btn-bulk-select">Bulk Select...</button>
          <div class="sync-options">
            <label class="sync-option">
              <input type="checkbox" id="enablePublish" checked />
              <span>Publish</span>
            </label>
          </div>
          <button id="bulkSyncBtn" class="btn-bulk-sync" disabled>Sync Selected with DA</button>
        </div>
        <div id="recipeList" class="recipe-list"></div>
        <div id="syncProgress" class="sync-progress" style="display: none;">
          <h3>Sync Progress</h3>
          <div id="syncLog" class="sync-log"></div>
        </div>
      </div>

      <!-- Bulk Select Modal -->
      <div id="bulkSelectModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Bulk Select Recipes</h3>
            <button id="closeBulkSelectModal" class="modal-close">&times;</button>
          </div>
          <div class="modal-body">
            <p class="modal-help">Paste URLs or recipe titles (one per line). Recipe numbers will be extracted from the last segment of URLs or from text containing recipe codes like <code>r00123</code>.</p>
            <textarea id="bulkSelectInput" class="bulk-select-textarea" placeholder="https://main--vitamix--aemsites.aem.page/us/en_us/recipes/data/almond-milk-r00013&#10;peanut-butter-cup-shake-r00888&#10;R01234"></textarea>
            <div id="bulkSelectPreview" class="bulk-select-preview"></div>
          </div>
          <div class="modal-footer">
            <button id="bulkSelectCancel" class="btn-modal-cancel">Cancel</button>
            <button id="bulkSelectApply" class="btn-modal-apply">Select Recipes</button>
          </div>
        </div>
      </div>

      <!-- Recipe Detail View -->
      <div id="detailView" class="detail-view" style="display: none;">
        <div class="detail-header">
          <button id="backToList" class="btn-back">&larr; Back to List</button>
          <h2>Recipe Details</h2>
        </div>
        <div class="loading" id="detailLoading">
          <div class="spinner"></div>
          <p>Loading recipe details...</p>
        </div>
        <div id="detailContent" class="detail-content"></div>
      </div>
    </div>
  </body>
</html>

